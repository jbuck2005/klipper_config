# info here - https://docs.vorondesign.com/community/howto/samwiseg0/btt_smart_filament_sensor.html

[filament_switch_sensor switch_sensor]
switch_pin: ^FS_S # E0 stop [PC15 GND +5V] - red-> 5v, blue -> PC15 (https://docs.vorondesign.com/build/electrical/v0_miniE3_v30_wiring.html)
#pause_on_runout: False
pause_on_runout: True # This can be set to false to debug false positives putting the sensor in "monitor mode". The printer will not pause but it will run the runout_gcode below. 
event_delay: 3.0
pause_delay: 0.5

runout_gcode:
  PAUSE # [pause_resume] is required in printer.cfg
#  M117 Filament switch runout
  M117 switch runout

insert_gcode: # code to run after filament has been detected as being re-inserted
  M117 Filament switch inserted

[filament_motion_sensor encoder_sensor]
switch_pin: ^FS_E # z-stop [GND PC2] - bk->GND, green -> PC2 (https://docs.vorondesign.com/build/electrical/v0_miniE3_v30_wiring.html)
detection_length: 4 # 2.88 # the theoretical minimum for the sensor
extruder: extruder
#pause_on_runout: False
pause_on_runout: True # This can be set to false to debug false positives putting the sensor in "monitor mode". The printer will not pause but it will run the runout_gcode below. 
event_delay: 3.0
pause_delay: 0.5

runout_gcode:
  PAUSE # [pause_resume] is required in printer.cfg
#  M117 Filament encoder runout
  M117 encoder runout

insert_gcode: # code to run after filament has been detected as being re-inserted
  M117 Filament encoder inserted

[delayed_gcode DISABLEFILAMENTSENSOR] # This will disable the SFS 1 second after klipper starts
initial_duration: 1
gcode:
    SET_FILAMENT_SENSOR SENSOR=switch_sensor ENABLE=0
    SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=0

[gcode_macro SFS_ENABLE] # Add this to PRINT_START
description: Enable smart filament sensor
gcode:
    M117 ENABLING the Smart Filament Sensor
    G92 E0
    SET_FILAMENT_SENSOR SENSOR=switch_sensor ENABLE=1
    SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=1

[gcode_macro SFS_DISABLE] # Add this to PRINT_END and PRINT_CANCEL
description: Disable smart filament sensor 
gcode:
    M117 DISABLING the Smart Filament Sensor
    G92 E0
    SET_FILAMENT_SENSOR SENSOR=switch_sensor ENABLE=0
    SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=0